services:
  comfyui:
    image: docker.io/yanwk/comfyui-boot:rocm 
    container_name: comfyui
    devices:
      - /dev/kfd:/dev/kfd
      - /dev/dri:/dev/dri
    group_add:
      - video
    ports:
      - "8188:8188"
    environment:
      - HIP_VISIBLE_DEVICES=0
      - PYTORCH_TUNABLEOP_ENABLED=1
    volumes:
      - /opt/comfyui:/root
    labels:
      - "traefik.http.routers.comfyui.rule=Host(`comfyui.mdelponte.com`)" 
      - "traefik.http.routers.comfyui.entrypoints=websecure"
      - "traefik.http.routers.comfyui.tls=true"
      - "traefik.enable=true"
      - "traefik.http.middlewares.redirect-middleware.redirectscheme.scheme=https"
    networks:
      - proxynet

networks:
  proxynet:
    external: true
    name: proxynet